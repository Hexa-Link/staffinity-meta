name: "Setup Org Templates (Automated)"

on:
  workflow_dispatch:

jobs:
  create-templates:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout the TARGET repository (.github) using your PAT
      - name: Checkout .github repository
        uses: actions/checkout@v4
        with:
          repository: Hexa-Link/.github
          token: ${{ secrets.WORKFLOW_PAT }}
          path: target-repo

      # 2. Create the files inside the target repository folder
      - name: Create Template Files
        run: |
          cd target-repo
          mkdir -p .github/ISSUE_TEMPLATE

          # --- 1. Pull Request Template ---
          cat <<EOT > .github/PULL_REQUEST_TEMPLATE.md
          ## Description
          Describe the changes you have made clearly.

          ## Type of Change
          - [ ] üêõ Bug fix
          - [ ] ‚ú® New feature
          - [ ] ‚ôªÔ∏è Refactor / Chore
          - [ ] üìù Documentation update

          ## Checklist
          - [ ] I have performed a self-review of my code.
          - [ ] I have added tests (if applicable).
          - [ ] The code passes local tests.
          EOT

          # --- 2. Bug Report Template ---
          cat <<EOT > .github/ISSUE_TEMPLATE/bug_report.md
          ---
          name: üêõ Bug Report
          about: Create a report to help us improve
          title: "[BUG] "
          labels: type:bug
          assignees: ''
          ---

          **Describe the bug**
          A clear and concise description of what the bug is.

          **To Reproduce**
          Steps to reproduce the behavior:
          1. Go to '...'
          2. Click on '...'
          3. See error

          **Expected behavior**
          A clear and concise description of what you expected to happen.
          EOT

          # --- 3. Feature Request Template ---
          cat <<EOT > .github/ISSUE_TEMPLATE/feature_request.md
          ---
          name: üöÄ Feature Request
          about: Suggest an idea for this project
          title: "[FEAT] "
          labels: type:story
          assignees: ''
          ---

          **Is your feature request related to a problem? Please describe.**
          A clear and concise description of what the problem is.

          **Describe the solution you'd like**
          A clear and concise description of what you want to happen.

          **Acceptance Criteria**
          - [ ] The user can...
          EOT

          echo "Templates created successfully."

      # 3. Commit and Push the changes back to the .github repository
      - name: Commit and Push
        run: |
          cd target-repo
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"
          
          # Add files
          git add .github/PULL_REQUEST_TEMPLATE.md
          git add .github/ISSUE_TEMPLATE/bug_report.md
          git add .github/ISSUE_TEMPLATE/feature_request.md
          
          # Commit if there are changes
          if git diff --staged --quiet; then
            echo "No changes to commit."
          else
            git commit -m "feat: Add Org-wide Issue and PR Templates via Automation"
            git push
            echo "‚úÖ Templates pushed to Hexa-Link/.github"
          fi